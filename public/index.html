
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <title>Document</title>
</head>
<body>
    <div class="container">
        <form action="http://localhost:3001/users", method = "post" id="login">
            <ul class="inputs">
                <li>
                    <label for="name">Name</label>
                    <input type="text" id="name" name="user_name">
                </li>
                <li>
                    <label for="email">Email</label>
                    <input type="email" id="email" name="user_email">
                </li>
                <li>
                    <label for="age">Age</label>
                    <input type="number" id="age" name="user_age">
                </li>
            </ul>
            <input type="submit" value="Create User">
        </form>
        <button onclick = deleteUser()>Delete User</button>
    </div>
    
    <script>

        function deleteUser(){
            let name = document.querySelectorAll('input[type=checkbox]:checked')
            let nameToDelete = name[0].value;
            
            fetch(`/users/${nameToDelete}`, {
            method: "DELETE"})
            .then(response => response.json())
            .then(data => {
                if(data.success){
                    window.location = '/'
                }
            })
        }
        
        window.onload = function(){
            fetch('/users')
            .then(response => response.json())
            .then(data => {
                
                users = document.createElement('table');
                users.id = 'users';
                users.innerHTML = `<tr><th>Name</th><th>Email</th><th>Age</th>`
                for (user of data){
                    users.innerHTML += `<tr><td><input type= checkbox value='${user.name}'>${user.name}</td><td>${user.email}</td><td>${user.age}</td></tr>`
                    
                }
                document.body.append(users);
            })
            
        }
  
    </script>
</body>
</html>